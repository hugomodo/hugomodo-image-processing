{{ with .Get "context" }}
  {{ $.Scratch.Set "context" ($.Site.GetPage .) }}
{{ else }}
  {{ with $.Site.Data.imageProcessing.config.uploadsDir }}
    {{ $.Scratch.Set "context" ($.Site.GetPage .) }}
  {{ else }}
    {{ $.Scratch.Set "context" $.Page }}
  {{ end }}
{{ end }}

{{ $context := $.Scratch.Get "context" }}
{{ $src := .Get "src" }}
{{ $alt := .Get "alt" }}
{{ $caption := .Get "caption" }}
{{ $width := .Get "width" }}
{{ $height := .Get "height" }}

{{ partial "image-processing/imgproc.html" (dict "context" $context "src" $src "alt" $alt "caption" $caption "width" $width "height" $height) }}
